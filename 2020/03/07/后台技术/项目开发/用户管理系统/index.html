<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>用户管理系统 | WINGO BLOG</title>
  <meta name="description" content="基于 Spring Boot 的用户管理系统。">
<meta property="og:type" content="article">
<meta property="og:title" content="用户管理系统">
<meta property="og:url" content="https://wingowen.github.io/2020/03/07/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="WINGO&#39;S BLOG">
<meta property="og:description" content="基于 Spring Boot 的用户管理系统。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wingowen.github.io/img/2020/03/UserManagementSystem/Demand.PNG">
<meta property="og:image" content="https://wingowen.github.io/img/2020/03/UserManagementSystem/Database01.PNG">
<meta property="og:image" content="https://wingowen.github.io/img/2020/03/UserManagementSystem/Port.png">
<meta property="og:image" content="https://wingowen.github.io/img/2020/03/UserManagementSystem/VO.PNG">
<meta property="og:image" content="https://wingowen.github.io/img/2020/03/UserManagementSystem/ValidError01.png">
<meta property="og:image" content="https://wingowen.github.io/img/2020/03/UserManagementSystem/ValidError02.png">
<meta property="og:image" content="https://wingowen.github.io/img/2020/03/UserManagementSystem/ValidError03.png">
<meta property="og:image" content="https://wingowen.github.io/img/2020/03/UserManagementSystem/SQLLog01.png">
<meta property="og:image" content="https://wingowen.github.io/img/2020/03/UserManagementSystem/SQLLog03.png">
<meta property="article:published_time" content="2020-03-07T08:44:21.000Z">
<meta property="article:modified_time" content="2023-09-20T08:20:35.793Z">
<meta property="article:author" content="Wingo Wen">
<meta property="article:tag" content="demo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wingowen.github.io/img/2020/03/UserManagementSystem/Demand.PNG">
  <!-- Canonical links -->
  <link rel="canonical" href="https://wingowen.github.io/2020/03/07/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/index.html">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="WINGO'S BLOG" type="application/atom+xml">
</head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">WINGO.WEN</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
      </ul>
      
    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>得失从缘 心无增减</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80%E7%A7%91%E5%AD%A6/">基础科学</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E9%A1%B9/">杂项</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/">计算机科学</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Aysnc/" style="font-size: 13px;">Aysnc</a> <a href="/tags/Cache/" style="font-size: 13px;">Cache</a> <a href="/tags/Druid/" style="font-size: 13px;">Druid</a> <a href="/tags/Dubbo/" style="font-size: 13px;">Dubbo</a> <a href="/tags/ElasticSearch/" style="font-size: 13px;">ElasticSearch</a> <a href="/tags/Email/" style="font-size: 13px;">Email</a> <a href="/tags/Flume/" style="font-size: 13px;">Flume</a> <a href="/tags/Git/" style="font-size: 13px;">Git</a> <a href="/tags/HBase/" style="font-size: 13px;">HBase</a> <a href="/tags/Hadoop/" style="font-size: 13px;">Hadoop</a> <a href="/tags/Hive/" style="font-size: 13.2px;">Hive</a> <a href="/tags/Impala/" style="font-size: 13px;">Impala</a> <a href="/tags/InooDB/" style="font-size: 13px;">InooDB</a> <a href="/tags/JDBC/" style="font-size: 13px;">JDBC</a> <a href="/tags/JPA/" style="font-size: 13px;">JPA</a> <a href="/tags/Kafka/" style="font-size: 13px;">Kafka</a> <a href="/tags/Kudu/" style="font-size: 13.2px;">Kudu</a> <a href="/tags/Linux/" style="font-size: 13px;">Linux</a> <a href="/tags/Log/" style="font-size: 13px;">Log</a> <a href="/tags/MQ/" style="font-size: 13.2px;">MQ</a> <a href="/tags/MyBatis/" style="font-size: 13px;">MyBatis</a> <a href="/tags/MySQL/" style="font-size: 13px;">MySQL</a> <a href="/tags/Netty/" style="font-size: 14px;">Netty</a> <a href="/tags/Pandas/" style="font-size: 13px;">Pandas</a> <a href="/tags/SQL/" style="font-size: 13px;">SQL</a> <a href="/tags/Scheduled/" style="font-size: 13px;">Scheduled</a> <a href="/tags/Security/" style="font-size: 13px;">Security</a> <a href="/tags/Shiro/" style="font-size: 13px;">Shiro</a> <a href="/tags/Spring-Boot/" style="font-size: 14px;">Spring Boot</a> <a href="/tags/Web/" style="font-size: 13px;">Web</a> <a href="/tags/WebSocket/" style="font-size: 13px;">WebSocket</a> <a href="/tags/demo/" style="font-size: 13.4px;">demo</a> <a href="/tags/gRPC/" style="font-size: 13px;">gRPC</a> <a href="/tags/peewee/" style="font-size: 13px;">peewee</a> <a href="/tags/sklearn/" style="font-size: 13px;">sklearn</a> <a href="/tags/%E5%B7%A5%E4%BD%9C/" style="font-size: 13px;">工作</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 13px;">爬虫</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 13.6px;">算法</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 13px;">网络</a> <a href="/tags/%E8%80%83%E7%A0%94/" style="font-size: 13.8px;">考研</a> <a href="/tags/%E8%84%9A%E6%9C%AC%E5%91%BD%E4%BB%A4/" style="font-size: 13px;">脚本命令</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 13px;">设计模式</a> <a href="/tags/%E9%83%A8%E7%BD%B2/" style="font-size: 13px;">部署</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">九月 2023</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">9</span></li></ul>
    </div>
  </div>


    
  </div>
</aside>

  
  
  <aside class="sidebar sidebar-toc collapse   in  " id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.</span> <span class="toc-text"> 准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.</span> <span class="toc-text"> 接口的设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dto-%E7%B1%BB%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-number">2.1.</span> <span class="toc-text"> DTO 类的编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vo-%E7%B1%BB%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-number">2.2.</span> <span class="toc-text"> VO 类的编写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%B8%B8%E9%87%8F%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text"> 静态常量类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#urlconstant"><span class="toc-number">3.1.</span> <span class="toc-text"> UrlConstant</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#usertypeconstant"><span class="toc-number">3.2.</span> <span class="toc-text"> UserTypeConstant</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#imagecodeconstant"><span class="toc-number">3.3.</span> <span class="toc-text"> ImageCodeConstant</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#respoonseconstant"><span class="toc-number">3.4.</span> <span class="toc-text"> RespoonseConstant</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#userconstant"><span class="toc-number">3.5.</span> <span class="toc-text"> UserConstant</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">4.</span> <span class="toc-text"> 工具类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#md5-%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86"><span class="toc-number">4.1.</span> <span class="toc-text"> MD5 密码加密</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%94%9F%E6%88%90"><span class="toc-number">4.2.</span> <span class="toc-text"> 验证码生成</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">5.</span> <span class="toc-text"> 实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">6.</span> <span class="toc-text"> 数据源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#druid-%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">6.1.</span> <span class="toc-text"> Druid 连接池</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#druid-%E9%85%8D%E7%BD%AE"><span class="toc-number">6.2.</span> <span class="toc-text"> Druid 配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E5%90%88-mybatis"><span class="toc-number">7.</span> <span class="toc-text"> 整合 Mybatis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-mapper"><span class="toc-number">7.1.</span> <span class="toc-text"> 配置 Mapper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mapper-%E6%8E%A5%E5%8F%A3%E7%B1%BB"><span class="toc-number">7.2.</span> <span class="toc-text"> Mapper 接口类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mapper-%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.3.</span> <span class="toc-text"> Mapper 配置实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95"><span class="toc-number">7.4.</span> <span class="toc-text"> 编写测试方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B1%82"><span class="toc-number">8.</span> <span class="toc-text"> 业务逻辑层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mybatis-%E7%89%88%E6%9C%AC"><span class="toc-number">8.1.</span> <span class="toc-text"> Mybatis 版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-number">8.2.</span> <span class="toc-text"> 测试用例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%B1%82"><span class="toc-number">9.</span> <span class="toc-text"> 控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#swagger-%E6%95%B4%E5%90%88"><span class="toc-number">9.1.</span> <span class="toc-text"> Swagger 整合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99"><span class="toc-number">9.2.</span> <span class="toc-text"> 代码编写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#thymeleaf"><span class="toc-number">10.</span> <span class="toc-text"> Thymeleaf</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#loginhtml"><span class="toc-number">10.1.</span> <span class="toc-text"> login.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#indexhtml"><span class="toc-number">10.2.</span> <span class="toc-text"> index.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#modifyhtml"><span class="toc-number">10.3.</span> <span class="toc-text"> modify.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#registerhtml"><span class="toc-number">10.4.</span> <span class="toc-text"> register.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#userhtml"><span class="toc-number">10.5.</span> <span class="toc-text"> user.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#viewhtml"><span class="toc-number">10.6.</span> <span class="toc-text"> view.html</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">11.</span> <span class="toc-text"> 过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">12.</span> <span class="toc-text"> 全局异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-sql-%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0"><span class="toc-number">13.</span> <span class="toc-text"> 自定义 SQL 日志打印</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F"><span class="toc-number">14.</span> <span class="toc-text"> 跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">14.1.</span> <span class="toc-text"> 注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C"><span class="toc-number">15.</span> <span class="toc-text"> 自定义校验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E7%B1%BB"><span class="toc-number">15.1.</span> <span class="toc-text"> 注解类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E7%B1%BB"><span class="toc-number">15.2.</span> <span class="toc-text"> 校验类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E6%89%93%E5%8D%B0"><span class="toc-number">16.</span> <span class="toc-text"> 请求响应打印</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-后台技术/项目开发/用户管理系统" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      用户管理系统
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2020/03/07/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" class="article-date">
	  <time datetime="2020-03-07T08:44:21.000Z" itemprop="datePublished">2020-03-07</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/demo/" rel="tag">demo</a>
  </span>


        

        <!-- <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/03/07/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/#comments" class="article-comment-link">评论</a></span> -->
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>基于 Spring Boot 的用户管理系统。</p>
<span id="more"></span>
<h3 id="准备工作"><a class="markdownIt-Anchor" href="#准备工作"></a> 准备工作</h3>
<p>功能模块分析：</p>
<p><img src="/img/2020/03/UserManagementSystem/Demand.PNG" alt="" /></p>
<p>数据库表分析：</p>
<p><img src="/img/2020/03/UserManagementSystem/Database01.PNG" alt="" /></p>
<p>数据库建表语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `user_manage_demo` (</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">11</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键id，用户id&#x27;</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户密码&#x27;</span>,</span><br><span class="line">  `type` <span class="type">char</span>(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户类型（1：管理员；0：普通用户）&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;记录创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;记录修改时间&#x27;</span>,</span><br><span class="line">  `is_delete` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;记录是否逻辑删除（0：未删除；1：已删除）&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`user_id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_name_type` (`username`,`type`) <span class="keyword">USING</span> BTREE COMMENT <span class="string">&#x27;用户名称、类型唯一索引&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">6</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;用户管理表&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>在数据库表中初始化一条管理员数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `springboot_user`.`<span class="keyword">user</span>`</span><br><span class="line">	(`user_id`, `username`, `password`, `type`, `gmt_create`, `gmt_modified`, `is_delete`) </span><br><span class="line"><span class="keyword">VALUES</span> </span><br><span class="line">	(<span class="number">1</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, &quot;1&quot;, <span class="string">&#x27;2019-05-19 20:26:22&#x27;</span>, <span class="string">&#x27;2019-05-19 20:26:27&#x27;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h3 id="接口的设计"><a class="markdownIt-Anchor" href="#接口的设计"></a> 接口的设计</h3>
<blockquote>
<p>为了项目代码更加简洁，此项目添加了 Lombok 支持依赖并且 IDEA 添加了相应的 Lombok 插件，通过在类注释<code>@Data</code>为相应的类添加Getter/Setter，toString()，equals() 等方法。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加 Lombok 的支持 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/img/2020/03/UserManagementSystem/Port.png" alt="" /></p>
<p>将前端传输过来的的数据封装在对应的 DTO 类中，用于展示层与服务层之间的数据传输对象。（View 👉 Action 👉 Srvice）</p>
<blockquote>
<p>DTO：Data Transfer Object（数据传输对象）DTO 是一组需要跨进程或网络边界传输的聚合数据的简单容器。它不应该包含业务逻辑，并将其行为限制为诸如内部一致性检查和基本验证之类的活动。</p>
</blockquote>
<p>将返回前端的数据封装在对应的 VO 类中。</p>
<blockquote>
<p>VO：View Object（视图对象）VO 的作用是把某个指定页面（或组件）的所有数据封装起来。</p>
</blockquote>
<h4 id="dto-类的编写"><a class="markdownIt-Anchor" href="#dto-类的编写"></a> DTO 类的编写</h4>
<p>在 DTO 类中添加 JSR303 校验。</p>
<blockquote>
<p>JSR303 是一项标准，JSR-349 是其的升级版本，添加了一些新特性，他们规定一些校验规范即校验注解，如 <code>@Null</code>，<code>@NotNull</code>，<code>@Pattern</code>，在 javax.validation.constraints 包下，只提供规范不提供实现。</p>
<p>Hibernat Validation 是对这个规范的实践（不要将 Hibernate 和数据库 ORM 框架联系在一起），他提供了相应的实现，并增加了一些其他校验注解，如<code>@Email</code>，<code>@Length</code>，<code>@Range</code>等等，在 org.hibernate.validator.constraints 包下。</p>
<p>Spring 为了给开发者提供便捷，对 Hibernate Validation 进行了二次封装，显示校验 Validated Bean 时，你可以使用 Spring validation 或者 Hibernate validation，而 Spring Validation 另一个特性，便是其在 Spring MVC 模块中添加了自动校验，并将校验信息封装进了特定的类中。这无疑便捷了我们的 web 开发。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* DTO 类示例</span></span><br><span class="line"><span class="comment">* <span class="doctag">@NotBlank</span> 用于 String（会去掉空格）</span></span><br><span class="line"><span class="comment">* <span class="doctag">@NotNull</span> 用于 Integer</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Data</span> 自动生成 Getter/Setter，toString()，equals() 等方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户名 */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用户名不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">/** 用户密码 */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用户密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/** 验证码 */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;验证码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String checkCode;</span><br><span class="line">    <span class="comment">/** 类型 */</span></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;用户类型不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="vo-类的编写"><a class="markdownIt-Anchor" href="#vo-类的编写"></a> VO 类的编写</h4>
<p><img src="/img/2020/03/UserManagementSystem/VO.PNG" alt="" /></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* VO 类示例</span></span><br><span class="line"><span class="comment">* 管理员用户列表页面的用户信息返回对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户标识 */</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="comment">/** 用户名 */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">/** 用户类型 */</span></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="comment">/** 用户创建时间 */</span></span><br><span class="line">    <span class="keyword">private</span> Date gtmCreate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="静态常量类"><a class="markdownIt-Anchor" href="#静态常量类"></a> 静态常量类</h3>
<p>将项目中一些固定的字面量定义为不可变的静态常量<code>public static final</code>。</p>
<h4 id="urlconstant"><a class="markdownIt-Anchor" href="#urlconstant"></a> UrlConstant</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* URL 静态常量类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UrlConstant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加私有的构造函数，防止静态常量类构造其它的实例，然后改变静态常量的值 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">UrlConstant</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Utility class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 跳转首页 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INDEX</span> <span class="operator">=</span> <span class="string">&quot;/index&quot;</span>;</span><br><span class="line">    <span class="comment">/** 跳转注册 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REGISTER</span> <span class="operator">=</span> <span class="string">&quot;/register&quot;</span>;</span><br><span class="line">    <span class="comment">/** 跳转登录 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOGIN</span> <span class="operator">=</span> <span class="string">&quot;/login&quot;</span>;</span><br><span class="line">    <span class="comment">/** 跳转查看用户列表 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">VIEW</span> <span class="operator">=</span> <span class="string">&quot;/view&quot;</span>;</span><br><span class="line">    <span class="comment">/** 跳转新增用户 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;/user&quot;</span>;</span><br><span class="line">    <span class="comment">/** 跳转修改用户信息 URL */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MODIFY</span> <span class="operator">=</span> <span class="string">&quot;/modify&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="usertypeconstant"><a class="markdownIt-Anchor" href="#usertypeconstant"></a> UserTypeConstant</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 用户类型静态常量类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UserTypeConstant</span> &#123; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 添加私有的构造函数，防止静态常量类构造其它的实例，然后改变静态常量的值 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">UserTypeConstant</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Utility class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 管理员用户 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ADMIN</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 普通用户 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ORDINARY</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户类型代码转描述</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 用户类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户类型中文描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">typeToDesc</span><span class="params">(Sting type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (UserTypeConstant.ADMIN.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;管理员&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (UserTypeConstant.ORDINARY.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;普通用户&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;未知身份，请联系系统管理员&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="imagecodeconstant"><a class="markdownIt-Anchor" href="#imagecodeconstant"></a> ImageCodeConstant</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ImageCodeConstant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加私有的构造函数，防止静态常量类构造其它的实例，然后改变静态常量的值 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ImageCodeConstant</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Utility class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 验证码生成的时间 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CODE_TIME</span> <span class="operator">=</span> <span class="string">&quot;codeTime&quot;</span>;</span><br><span class="line">    <span class="comment">/** 验证码过期时间，单位：分钟 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CAPTCHA_EXPIRY_TIME</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="comment">/** 秒/毫秒换算 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MILLISECOND_CONVERSION</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">    <span class="comment">/** 分钟/秒换算 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MINUTE_CONVERSION</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">    <span class="comment">/** 生成验证码的变量名称 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SIMPLE_CAPTCHA</span> <span class="operator">=</span> <span class="string">&quot;simpleCaptcha&quot;</span>;</span><br><span class="line">    <span class="comment">/** 生成验证码的变量值 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CAPTCHA_VALUE</span> <span class="operator">=</span> <span class="string">&quot;captchaValue&quot;</span>;</span><br><span class="line">    <span class="comment">/** 生成的验证码图形的变量名 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">IMAGE</span> <span class="operator">=</span> <span class="string">&quot;image&quot;</span>;</span><br><span class="line">    <span class="comment">/** 生成的图形验证码文件格式化的名称 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JPEG</span> <span class="operator">=</span> <span class="string">&quot;JPEG&quot;</span>;</span><br><span class="line">    <span class="comment">/** 图片字符涉及的罗马字体名 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TIMES_NEW_ROMAN</span> <span class="operator">=</span> <span class="string">&quot;Times New Roman&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="respoonseconstant"><a class="markdownIt-Anchor" href="#respoonseconstant"></a> RespoonseConstant</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ResponseConstant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加私有的构造函数，防止静态常量类构造其它的实例，然后改变静态常量的值 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ResponseConstant</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Utility class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理成功时返回的 Code */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;200&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 业务处理失败时返回的 Code */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FAIL</span> <span class="operator">=</span> <span class="string">&quot;-1&quot;</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 返回信息的 Key 常量值 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RESPONSE_VO</span> <span class="operator">=</span> <span class="string">&quot;responseVO&quot;</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 返回状态码常量值 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CODE</span> <span class="operator">=</span> <span class="string">&quot;code&quot;</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/** 返回状态信息常量值 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MESSAGE</span> <span class="operator">=</span> <span class="string">&quot;message&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="userconstant"><a class="markdownIt-Anchor" href="#userconstant"></a> UserConstant</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">UserConstant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 添加私有的构造函数，防止静态常量类构造其它的实例，然后改变静态常量的值 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">UserConstant</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Utility class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** Session 中的用户名常量的字段名称，多处使用统一在这里定义，避免 SonarLint 魔法值的告警 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USERNAME</span> <span class="operator">=</span> <span class="string">&quot;username&quot;</span>;</span><br><span class="line">    <span class="comment">/** Session 中的用户类型常量的字段名称，多处使用统一在这里定义，避免 SonarLint 魔法值的告警 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TYPE</span> <span class="operator">=</span> <span class="string">&quot;type&quot;</span>;</span><br><span class="line">    <span class="comment">/** Session 中的用户类型名称常量的字段名称，多处使用统一在这里定义，避免 SonarLint 魔法值的告警 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TYPE_NAME</span> <span class="operator">=</span> <span class="string">&quot;typeName&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="工具类"><a class="markdownIt-Anchor" href="#工具类"></a> 工具类</h3>
<h4 id="md5-密码加密"><a class="markdownIt-Anchor" href="#md5-密码加密"></a> MD5 密码加密</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Md5Util</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Md5Util</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Utility class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * md5 加密通用工具类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode 需加密的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> md5 加密后的字符串（32位字符串）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5</span><span class="params">(String encode)</span> &#123;</span><br><span class="line">        <span class="comment">// 检验参数是否是 null 或者 &quot;&quot; 或者 &quot; &quot; 等</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(encode)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span>[] hexDigits = &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>&#125;;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 设置字符集</span></span><br><span class="line">            <span class="type">byte</span>[] strTemp = encode.getBytes(StandardCharsets.UTF_8);</span><br><span class="line">            <span class="comment">// 生成一个 md5 加密计算摘要</span></span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">mdTemp</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">            <span class="comment">// 计算 md5 函数</span></span><br><span class="line">            mdTemp.update(strTemp);</span><br><span class="line">            <span class="comment">// digest() 最后确定返回 md5 hash 值，返回值为 8 位字符串。因为 md5 hash 值是 16 位的 hex 值，实际上就是 8 位的字符</span></span><br><span class="line">            <span class="type">byte</span>[] md = mdTemp.digest();</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> md.length;</span><br><span class="line">            <span class="type">char</span>[] str = <span class="keyword">new</span> <span class="title class_">char</span>[j * <span class="number">2</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">byte</span> byte0 : md) &#123;</span><br><span class="line">                <span class="comment">// 不带符号右移四位(不管 byte0 的类型 位移处补 0)，&amp; 十六进制的 f 即 高四位清空 取低四位的值，&gt;&gt;&gt; 优先级高于 &amp;</span></span><br><span class="line">                str[k++] = hexDigits[byte0 &gt;&gt;&gt; <span class="number">4</span> &amp; <span class="number">0xf</span>];</span><br><span class="line">                str[k++] = hexDigits[byte0 &amp; <span class="number">0xf</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(str);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="验证码生成"><a class="markdownIt-Anchor" href="#验证码生成"></a> 验证码生成</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageCodeUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ImageCodeUtil</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Utility class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 生成验证码图片的默认宽度 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">IMAGE_WIDTH</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">    <span class="comment">/** 生成验证码图片的默认高度 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">IMAGE_HEIGHT</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">    <span class="comment">/** 随机干扰线的条数，太稀疏或者太密织都达不到干扰的效果 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">RAND_COLOR</span> <span class="operator">=</span> <span class="number">168</span>;</span><br><span class="line">    <span class="comment">/** 颜色数值的上限，三原色的范围都是 [0, 255] 范围 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">COLOR_MAX</span> <span class="operator">=</span> <span class="number">255</span>;</span><br><span class="line">    <span class="comment">/** 可根据需要来修改，生成纯数字或者纯字母，或者默认这种混合的 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span>[] mapTable = &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成图形验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width 生成的图形验证码的宽度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height 生成的图形验证码的高度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifySize 需要生成的验证码位数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 验证码的图片对象及验证码的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title function_">getImageCode</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height, <span class="type">int</span> verifySize)</span></span><br><span class="line">            <span class="keyword">throws</span> NoSuchAlgorithmException &#123;</span><br><span class="line">        Map&lt;String, Object&gt; returnMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">6</span>);</span><br><span class="line">        <span class="comment">// 确保验证码的宽度和高度不能小于或等于零</span></span><br><span class="line">        width = width &lt;= <span class="number">0</span> ? IMAGE_WIDTH : width;</span><br><span class="line">        height = height &lt;= <span class="number">0</span> ? IMAGE_HEIGHT : height;</span><br><span class="line">        <span class="comment">// BufferedImage 是 Image 的一个子类，Image 和 BufferedImage</span></span><br><span class="line">        <span class="comment">// 主要作用就是将一副图片加载到内存中，BufferedImage 生成的图片在内存里有一个图像缓冲区</span></span><br><span class="line">        <span class="comment">// 利用这个缓冲区我们可以很方便的操作这个图片，通常用来做图片修改操作如大小变换、图片变灰、设置图片透明或不透明等</span></span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedImage</span>(width, height, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="comment">// 获取图形上下文</span></span><br><span class="line">        <span class="type">Graphics</span> <span class="variable">g</span> <span class="operator">=</span> image.getGraphics();</span><br><span class="line">        <span class="comment">// 生成随机类</span></span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> SecureRandom.getInstanceStrong();</span><br><span class="line">        <span class="comment">// 设定背景色</span></span><br><span class="line">        g.setColor(getRandColor(<span class="number">200</span>, <span class="number">250</span>));</span><br><span class="line">        <span class="comment">// 画长方形</span></span><br><span class="line">        g.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">        <span class="comment">// 设定字体</span></span><br><span class="line">        g.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(ImageCodeConstant.TIMES_NEW_ROMAN, Font.PLAIN, <span class="number">18</span>));</span><br><span class="line">        <span class="comment">// 再次设置背景色，实测跟前一次设置背景色有叠加的效果，会让背景颜色看起来更复杂</span></span><br><span class="line">        g.setColor(getRandColor(<span class="number">160</span>, <span class="number">200</span>));</span><br><span class="line">        <span class="comment">// 随机产生 168 条干扰线，使图象中的认证码不易被其它程序探测到</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; RAND_COLOR; i++) &#123;</span><br><span class="line">            <span class="comment">// nextInt(n) 会返回 [0, n) 之间的随机数</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> random.nextInt(width);</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> random.nextInt(height);</span><br><span class="line">            <span class="type">int</span> <span class="variable">xl</span> <span class="operator">=</span> random.nextInt(<span class="number">12</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">yl</span> <span class="operator">=</span> random.nextInt(<span class="number">12</span>);</span><br><span class="line">            <span class="comment">// x: 线段起点的横坐标；y: 线段起点的纵坐标；x + xl: 线段终点的横坐标；y + yl: 线段终点的纵坐标</span></span><br><span class="line">            g.drawLine(x, y, x + xl, y + yl);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 定义验证码的值</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">captchaValue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="comment">// 4代表验证码位数，如果要生成更多位的认证码，则加大数值</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; verifySize; ++i) &#123;</span><br><span class="line">            captchaValue.append(mapTable[random.nextInt(mapTable.length)]);</span><br><span class="line">            <span class="comment">// 将认证码显示到图象中</span></span><br><span class="line">            g.setColor(<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>), <span class="number">20</span> + random.nextInt(<span class="number">110</span>)));</span><br><span class="line">            <span class="comment">// 直接生成</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> captchaValue.substring(i, i + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">// 使用此图形上下文的当前字体和颜色绘制由指定 string 给定的文本</span></span><br><span class="line">            g.drawString(str, <span class="number">13</span> * i + <span class="number">6</span>, <span class="number">16</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 释放图形上下文资源</span></span><br><span class="line">        g.dispose();</span><br><span class="line">        <span class="comment">// 组装图像结果及验证码值并返回</span></span><br><span class="line">        returnMap.put(ImageCodeConstant.IMAGE, image);</span><br><span class="line">        returnMap.put(ImageCodeConstant.CAPTCHA_VALUE, captchaValue.toString());</span><br><span class="line">        <span class="keyword">return</span> returnMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 给定范围获得随机颜色 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Color <span class="title function_">getRandColor</span><span class="params">(<span class="type">int</span> fc, <span class="type">int</span> bc)</span> <span class="keyword">throws</span> NoSuchAlgorithmException &#123;</span><br><span class="line">        <span class="comment">// 创建一个随机数生成对象的实例</span></span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> SecureRandom.getInstanceStrong();</span><br><span class="line">        <span class="comment">// 颜色值不能超过最大范围</span></span><br><span class="line">        fc = fc &gt; COLOR_MAX ? COLOR_MAX : fc;</span><br><span class="line">        bc = bc &gt; COLOR_MAX ? COLOR_MAX : bc;</span><br><span class="line">        <span class="comment">// nextInt(n) 会返回 [0, n) 之间的随机数</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="type">int</span> <span class="variable">g</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="comment">// 按随机生成的 r、g、b 值设置颜色并返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Color</span>(r, g, b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实体类"><a class="markdownIt-Anchor" href="#实体类"></a> 实体类</h3>
<p>实体类的属性与数据库的字段相对应。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMybatis</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户 id */</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="comment">/** 用户名 */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">/** 用户密码 */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/** 用户类型 */</span></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="comment">/** 记录创建时间 */</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line">    <span class="comment">/** 记录修改时间 */</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtModified;</span><br><span class="line">    <span class="comment">/** 记录是否删除 */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isDelete;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数据源"><a class="markdownIt-Anchor" href="#数据源"></a> 数据源</h3>
<p>配置数据源：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据源配置</span></span><br><span class="line"><span class="comment"># serverTimezone=Asia/Shanghai 这种写法也可以</span></span><br><span class="line"><span class="comment"># SSL 连接必须显示的进行配置是否使用，否则会报警告</span></span><br><span class="line"><span class="comment"># 使用 MySQL80 服务 mysql-connector-java:8.0.19 版本的连接 Jar 包 DriverClass：com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/springboot_user?serverTimezone=GMT%2B8&amp;useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">spring.datasource.driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>
<p>测试数据源是否配置成功：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JavaSpringWingoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试 DataSource 是否被成功注入</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(dataSource.getClass());</span><br><span class="line">        <span class="comment">// 输出结果 class com.zaxxer.hikari.HikariDataSource Spring Boot 2 的默认连接池 Hikari</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="druid-连接池"><a class="markdownIt-Anchor" href="#druid-连接池"></a> Druid 连接池</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 支持阿里 Druid 连接池 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 方式一：使用 Spring Boot 提供的启动器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 方式二：此方式需要自行编写 Druid 配置类引入配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;version&gt;1.1.16&lt;/version&gt; 此版本找不到依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="druid-配置"><a class="markdownIt-Anchor" href="#druid-配置"></a> Druid 配置</h4>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Druid连接池配置</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment">## Druid 连接池配置</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment"># 初始化大小、最小、最大</span></span><br><span class="line"><span class="attr">spring.datasource.initialSize</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">spring.datasource.minIdle</span>=<span class="string">3</span></span><br><span class="line"><span class="attr">spring.datasource.maxActive</span>=<span class="string">20</span></span><br><span class="line"><span class="comment"># 获取连接等待超时时间</span></span><br><span class="line"><span class="attr">spring.datasource.maxWait</span>=<span class="string">60000</span></span><br><span class="line"><span class="comment"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span></span><br><span class="line"><span class="attr">spring.datasource.timeBetweenEvictionRunsMillis</span>=<span class="string">30000</span></span><br><span class="line"><span class="comment"># 指定获取连接时连接校验的sql查询语句</span></span><br><span class="line"><span class="attr">spring.datasource.validationQuery</span>=<span class="string">select &#x27;x&#x27;</span></span><br><span class="line"><span class="comment"># 获取连接后，确实是否要进行连接空闲时间的检查</span></span><br><span class="line"><span class="attr">spring.datasource.testWhileIdle</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 获取连接检测</span></span><br><span class="line"><span class="attr">spring.datasource.testOnBorrow</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># 归还连接检测</span></span><br><span class="line"><span class="attr">spring.datasource.testOnReturn</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># 指定连接校验查询的超时时间</span></span><br><span class="line"><span class="attr">spring.datasource.validationQueryTimeout</span>=<span class="string">600000</span></span><br><span class="line"><span class="comment"># 配置一个连接在池总最小生存的时间</span></span><br><span class="line"><span class="attr">spring.datasource.minEvictableIdleTimeMillis</span>=<span class="string">300000</span></span><br><span class="line"><span class="comment"># 打开 PSCache，并且指定每个连接上 Cache 的大小</span></span><br><span class="line"><span class="attr">spring.datasource.poolPreparedStatements</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.datasource.maxPoolPreparedStatementPerConnectionSize</span>=<span class="string">20</span></span><br><span class="line"><span class="comment"># 配置监控统计拦截的 filter，去掉后监控界面 sql 无法统计，wall 用于防火墙，stat 用于监控统计</span></span><br><span class="line"><span class="attr">spring.datasource.filters</span>=<span class="string">stat,wall,slf4j</span></span><br><span class="line"><span class="comment"># 通过 connectProperties 属性来打开 mergeSql 功能，慢 sql 记录等</span></span><br><span class="line"><span class="attr">spring.datasource.connectionProperties</span>=<span class="string">druid.stat.mergeSql=true;druid.stat.logSlowSql=true;druid.stat.slowSqlMillis=5000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## druid连接池监控 访问 URL：locahost:8080/druid </span></span><br><span class="line"><span class="comment"># 需要账号密码才能访问控制台，默认为root</span></span><br><span class="line"><span class="attr">spring.datasource.druid.stat-view-servlet.login-username</span>=<span class="string">admin</span></span><br><span class="line"><span class="attr">spring.datasource.druid.stat-view-servlet.login-password</span>=<span class="string">123</span></span><br><span class="line"><span class="comment"># 访问路径为/druid时，跳转到StatViewServlet</span></span><br><span class="line"><span class="attr">spring.datasource.druid.stat-view-servlet.url-pattern</span>=<span class="string">/druid/*</span></span><br><span class="line"><span class="comment"># 是否能够重置数据</span></span><br><span class="line"><span class="attr">spring.datasource.druid.stat-view-servlet.reset-enable</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># 排除一些静态资源，以提高效率</span></span><br><span class="line"><span class="attr">spring.datasource.druid.web-stat-filter.exclusions</span>=<span class="string">*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*</span></span><br></pre></td></tr></table></figure>
<p>再次测试控制台输出的 DataSource 的类型为 com.alibaba.druid.pool.DruidDataSource。</p>
<h3 id="整合-mybatis"><a class="markdownIt-Anchor" href="#整合-mybatis"></a> 整合 Mybatis</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 支持 MyBatis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="配置-mapper"><a class="markdownIt-Anchor" href="#配置-mapper"></a> 配置 Mapper</h4>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## MyBatis 配置</span></span><br><span class="line"><span class="comment"># 配置别名 parameterType 直接使用类名</span></span><br><span class="line"><span class="attr">mybatis.typeAliasesPackage</span>=<span class="string">com.wingo.user.entity</span></span><br><span class="line"><span class="attr">mybatis.mapperLocations</span>=<span class="string">classpath:mapping/*.xml</span></span><br><span class="line"><span class="comment"># 打印 MyBatis 执行的 SQL 打印出来</span></span><br><span class="line"><span class="attr">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>
<p>Mybatis 编写数据库操作的方法对应的 XxxMapper.java 接口类，以及对应的 XxxMapper.xml 配置类，配置类用于编写具体的 SQL 语句以便 Mybatis 进行动态实现。</p>
<h4 id="mapper-接口类"><a class="markdownIt-Anchor" href="#mapper-接口类"></a> Mapper 接口类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 也可通过在 Spring Boot 运行类上添加 @MapperScan() 注解扫描</span></span><br><span class="line"><span class="meta">@Mapper</span> <span class="comment">// 扫描此类为 Mybatis 的 mapper 类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMybatisMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户注册 / 添加用户：在数据库中添加用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userMybatis 用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(UserMybatis userMybatis)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户登录：通过用户名、用户密码和用户类型查询用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 用户密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 用户类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UserMybatis <span class="title function_">findUserMybatisByUsernameAndPasswordAndType</span><span class="params">(String username, String password, String type)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 管理员用户管理页面：通过用户类型和用户状态查询用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 用户类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isDelete 用户状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UserMybatis&gt; <span class="title function_">findAllByTypeAndStatus</span><span class="params">(String type, Integer isDelete)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户修改密码：通过用户名和用户类修改用户密码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 用户密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 用户类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> gmtModified 用户修改时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updatePasswordByUsernameAndType</span><span class="params">(String password, String username, String type, Date gmtModified)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userMybatis 用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(UserMybatis userMybatis)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *管理员删除用户：通过用户标识更新用户状态</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户标识</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> gmtModified 用户修改时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateStatusByUserId</span><span class="params">(Integer userId, Date gmtModified)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过用户名和用户类型查找用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type 用户类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UserMybatis <span class="title function_">findUserMybatisByUsernameAndType</span><span class="params">(String username, String type)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="mapper-配置实现"><a class="markdownIt-Anchor" href="#mapper-配置实现"></a> Mapper 配置实现</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.wingo.user.mapper.UserMybatisMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 编写字段与属性的映射关系 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.wingo.user.entity.UserMybatis&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;type&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;CHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;type&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gmt_create&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gmtCreate&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gmt_modified&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gmtModified&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;is_delete&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIT&quot;</span> <span class="attr">property</span>=<span class="string">&quot;isDelete&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;UserMybatis&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;userId&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO</span><br><span class="line">            user (user_id, username, password,type, gmt_create, gmt_modified, is_delete)</span><br><span class="line">        VALUES</span><br><span class="line">            (#&#123;userId&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;type&#125;, #&#123;gmtCreate&#125;, #&#123;gmtModified&#125;, #&#123;isDelete&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserMybatisByUsernameAndPasswordAndType&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            user_id, username, password, type, gmt_create, gmt_modified, is_delete</span><br><span class="line">        FROM</span><br><span class="line">            user</span><br><span class="line">        WHERE</span><br><span class="line">            username = #&#123;username&#125;</span><br><span class="line">        AND</span><br><span class="line">            password = #&#123;password&#125;</span><br><span class="line">        AND</span><br><span class="line">            type = #&#123;type&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllByTypeAndStatus&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            user_id, username, password, type, gmt_create, gmt_modified, is_delete</span><br><span class="line">        FROM</span><br><span class="line">             user</span><br><span class="line">        WHERE</span><br><span class="line">            type = #&#123;type&#125;</span><br><span class="line">        AND</span><br><span class="line">            is_delete = #&#123;isDelete&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserMybatisByUsernameAndType&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            user_id, username, password, type, gmt_create, gmt_modified, is_delete</span><br><span class="line">        FROM</span><br><span class="line">             user</span><br><span class="line">        WHERE</span><br><span class="line">            username = #&#123;username&#125;</span><br><span class="line">        AND</span><br><span class="line">            type = #&#123;type&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;UserMybatis&quot;</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            user</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">                username = #&#123;username&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span></span><br><span class="line">                password = #&#123;password&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;type != null&quot;</span>&gt;</span></span><br><span class="line">                type = #&#123;type&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gmtCreate != null&quot;</span>&gt;</span></span><br><span class="line">                gmt_create = #&#123;gmtCreate&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gmtModified != null&quot;</span>&gt;</span></span><br><span class="line">                gmt_modified = #&#123;gmtModified&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;isDelete != null&quot;</span>&gt;</span></span><br><span class="line">                is_delete = #&#123;isDelete&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        WHERE</span><br><span class="line">            user_id = #&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updatePasswordByUsernameAndType&quot;</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            user</span><br><span class="line">        SET</span><br><span class="line">            password = #&#123;password&#125;, gmt_modified = #&#123;gmtModified&#125;</span><br><span class="line">        where</span><br><span class="line">            username =#&#123;username&#125;</span><br><span class="line">        and</span><br><span class="line">            type = #&#123;type&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStatusByUserId&quot;</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            user</span><br><span class="line">        SET</span><br><span class="line">            is_delete = true, gmt_modified = #&#123;gmtModified&#125;</span><br><span class="line">        WHERE</span><br><span class="line">            user_id = #&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="编写测试方法"><a class="markdownIt-Anchor" href="#编写测试方法"></a> 编写测试方法</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaSpringWingoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMybatisMapper userMybatisMapper;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">UserMybatis</span> <span class="variable">userMybatis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMybatis</span>();</span><br><span class="line">        userMybatis.setUsername(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        userMybatis.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        userMybatis.setType(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        userMybatis.setGmtCreate(date);</span><br><span class="line">        userMybatis.setGmtModified(date);</span><br><span class="line">        userMybatis.setIsDelete(<span class="literal">false</span>);</span><br><span class="line">        userMybatisMapper.insert(userMybatis);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">    * UserMybatis userMybatis = userMybatisMapper.</span></span><br><span class="line"><span class="comment">    *	findUserMybatisByUsernameAndPasswordAndType(&quot;张三&quot;,&quot;123456&quot;,&quot;0&quot;);</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * List&lt;UserMybatis&gt; list = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">    * list = userMybatisMapper.findAllByTypeAndStatus(&quot;0&quot;,0);</span></span><br><span class="line"><span class="comment">    * Iterator&lt;UserMybatis&gt; iterable = list.iterator();</span></span><br><span class="line"><span class="comment">    * while (iterable.hasNext())&#123;</span></span><br><span class="line"><span class="comment">    * 	UserMybatis userMybatis = iterable.next();</span></span><br><span class="line"><span class="comment">    * 	System.out.println(userMybatis);</span></span><br><span class="line"><span class="comment">    * &#125;</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * UserMybatis userMybatis = userMybatisMapper.findUserMybatisByUsernameAndType(&quot;张三&quot;,&quot;0&quot;);</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * UserMybatis userMybatis = new UserMybatis();</span></span><br><span class="line"><span class="comment">    * userMybatis.setUserId(6);</span></span><br><span class="line"><span class="comment">    * userMybatis.setUsername(&quot;李四&quot;);</span></span><br><span class="line"><span class="comment">    * int result = userMybatisMapper.update(userMybatis);</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * Date date = new Date();</span></span><br><span class="line"><span class="comment">    * userMybatisMapper.updatePasswordByUsernameAndType(&quot;654321&quot;,&quot;李四&quot;,&quot;0&quot;,date);</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * Date date = new Date();</span></span><br><span class="line"><span class="comment">    * userMybatisMapper.updateStatusByUserId(6,date);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="业务逻辑层"><a class="markdownIt-Anchor" href="#业务逻辑层"></a> 业务逻辑层</h3>
<h4 id="mybatis-版本"><a class="markdownIt-Anchor" href="#mybatis-版本"></a> Mybatis 版本</h4>
<p>编写项目场景功能的业务逻辑：接收前端传来的信息所封住的 DTO，然后调用 DAO 进行业务逻辑的编写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;userServiceMybatisImpl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceMybatisImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span></span><br><span class="line">    UserMybatisMapper userMybatisMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceMybatisImpl</span><span class="params">(UserMybatisMapper userMybatisMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userMybatisMapper = userMybatisMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查此用户是否已经存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkUserDuplicate</span><span class="params">(String username)</span>&#123;</span><br><span class="line">        <span class="comment">// 定义默认返回 false</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isDuplicate</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">UserMybatis</span> <span class="variable">userMybatis</span> <span class="operator">=</span> userMybatisMapper.findUserMybatisByUsernameAndType(username, UserTypeConstant.ORDINARY);</span><br><span class="line">        <span class="comment">// 若此用户存在，则返回 true</span></span><br><span class="line">        <span class="keyword">if</span>(userMybatis!=<span class="literal">null</span>)&#123;</span><br><span class="line">            isDuplicate = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isDuplicate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserMybatis <span class="title function_">buildUserMybatis</span><span class="params">(String username, String password)</span>&#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="comment">// 创建用户实体对象并进行赋值</span></span><br><span class="line">        <span class="type">UserMybatis</span> <span class="variable">userMybatis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMybatis</span>();</span><br><span class="line">        userMybatis.setUsername(username);</span><br><span class="line">        userMybatis.setPassword(Md5Util.md5(password));</span><br><span class="line">        userMybatis.setType(UserTypeConstant.ORDINARY);</span><br><span class="line">        userMybatis.setGmtCreate(data);</span><br><span class="line">        userMybatis.setGmtModified(data);</span><br><span class="line">        userMybatis.setIsDelete(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span> userMybatis;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户注册 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVO <span class="title function_">register</span><span class="params">(RegisterDTO registerDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// 定义返回对象</span></span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseVO</span>();</span><br><span class="line">        <span class="comment">// 检查此用户是否是否已经存在</span></span><br><span class="line">        <span class="keyword">if</span>(checkUserDuplicate(registerDTO.getUsername()))&#123;</span><br><span class="line">            <span class="comment">// 组装错误返回对象</span></span><br><span class="line">            responseVO.fail(<span class="string">&quot;用户名重复，请重新注册！&quot;</span>);</span><br><span class="line">            <span class="comment">// 返回错误代码及错误信息</span></span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 创建用户实体对象并进行赋值</span></span><br><span class="line">        <span class="type">UserMybatis</span> <span class="variable">userMybatis</span> <span class="operator">=</span> buildUserMybatis(registerDTO.getUsername(), registerDTO.getPassword());</span><br><span class="line">        <span class="comment">// 保存数据到数据库</span></span><br><span class="line">        userMybatisMapper.insert(userMybatis);</span><br><span class="line">        <span class="comment">// 组装成功返回对象</span></span><br><span class="line">        responseVO.success(<span class="string">&quot;恭喜您，注册成功！请登录&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户登录 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVO <span class="title function_">login</span><span class="params">(LoginDTO loginDTO)</span> &#123;</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseVO</span>();</span><br><span class="line">        <span class="type">UserMybatis</span> <span class="variable">userMybatis</span> <span class="operator">=</span> userMybatisMapper.findUserMybatisByUsernameAndPasswordAndType</span><br><span class="line">                        (loginDTO.getUsername(), Md5Util.md5(loginDTO.getPassword()), loginDTO.getType());</span><br><span class="line">        <span class="keyword">if</span>(userMybatis == <span class="literal">null</span>)&#123;</span><br><span class="line">            responseVO.fail(<span class="string">&quot;登录失败，用户不存在、已删除或者用户名、密码或类型选择错误！&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        responseVO.success(<span class="string">&quot;登录成功！&quot;</span>);</span><br><span class="line">        <span class="comment">// 构建返回的用户信息</span></span><br><span class="line">        <span class="type">UserVO</span> <span class="variable">userVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserVO</span>();</span><br><span class="line">        userVO.setUsername(loginDTO.getUsername());</span><br><span class="line">        userVO.setType(loginDTO.getType());</span><br><span class="line">        responseVO.setData(<span class="string">&quot;userVO&quot;</span>, userVO);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 管理员添加用户 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVO <span class="title function_">add</span><span class="params">(AddDTO addDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// 定义返回对象</span></span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseVO</span>();</span><br><span class="line">        <span class="comment">// 检查此用户是否是否已经存在</span></span><br><span class="line">        <span class="keyword">if</span>(checkUserDuplicate(addDTO.getUsername()))&#123;</span><br><span class="line">            <span class="comment">// 组装错误返回对象</span></span><br><span class="line">            responseVO.fail(<span class="string">&quot;用户名重复，请重新添加！&quot;</span>);</span><br><span class="line">            <span class="comment">// 返回错误代码及错误信息</span></span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 创建用户实体对象并进行赋值</span></span><br><span class="line">        <span class="type">UserMybatis</span> <span class="variable">userMybatis</span> <span class="operator">=</span> buildUserMybatis(addDTO.getUsername(), addDTO.getPassword());</span><br><span class="line">        <span class="comment">// 保存数据到数据库</span></span><br><span class="line">        userMybatisMapper.insert(userMybatis);</span><br><span class="line">        <span class="comment">// 组装成功返回对象</span></span><br><span class="line">        responseVO.success(<span class="string">&quot;添加成功！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 管理员查看用户列表 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVO <span class="title function_">view</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseVO</span>();</span><br><span class="line">        <span class="comment">// 定义返回的结果集对象，这种定义方式是对象形式的集合</span></span><br><span class="line">        List&lt;ViewVO&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;UserMybatis&gt; userMybatisList = userMybatisMapper.findAllByTypeAndStatus(UserTypeConstant.ORDINARY, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span>(userMybatisList == <span class="literal">null</span>)&#123;</span><br><span class="line">            responseVO.fail(<span class="string">&quot;请求用户列表失败！&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(UserMybatis userMybatis : userMybatisList)&#123;</span><br><span class="line">            <span class="comment">// 创建一个新对象来存储查询出的一条条记录</span></span><br><span class="line">            <span class="type">ViewVO</span> <span class="variable">viewVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ViewVO</span>();</span><br><span class="line">            <span class="comment">// 对对象进行赋值</span></span><br><span class="line">            viewVO.setUserId(userMybatis.getUserId());</span><br><span class="line">            viewVO.setUsername(userMybatis.getUsername());</span><br><span class="line">            viewVO.setType(userMybatis.getType());</span><br><span class="line">            viewVO.setGtmCreate(userMybatis.getGmtCreate());</span><br><span class="line">            <span class="comment">// 将对象放入集合中</span></span><br><span class="line">            userList.add(viewVO);</span><br><span class="line">        &#125;</span><br><span class="line">        responseVO.success(<span class="string">&quot;请求用户列表成功！&quot;</span>);</span><br><span class="line">        responseVO.setData(<span class="string">&quot;viewVO&quot;</span>, userList);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 用户修改密码 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVO <span class="title function_">modify</span><span class="params">(ModifyDTO modifyDTO)</span> &#123;</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseVO</span>();</span><br><span class="line">        <span class="comment">// 判断是否有新密码且新旧密码是否一致</span></span><br><span class="line">        <span class="keyword">if</span>(modifyDTO.getNewPassword() != <span class="literal">null</span> &amp;&amp; modifyDTO.getConfirmNewPassword() != <span class="literal">null</span></span><br><span class="line">                &amp;&amp; !modifyDTO.getConfirmNewPassword().equals(modifyDTO.getNewPassword()))&#123;</span><br><span class="line">            responseVO.fail(<span class="string">&quot;新密码和确认新密码不一致，请检查！&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断用户的原密码是否正确</span></span><br><span class="line">        <span class="type">UserMybatis</span> <span class="variable">userMybatis</span> <span class="operator">=</span> userMybatisMapper.findUserMybatisByUsernameAndPasswordAndType(</span><br><span class="line">                modifyDTO.getUsername(), Md5Util.md5(modifyDTO.getPassword()), modifyDTO.getType()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span>(userMybatis == <span class="literal">null</span>)&#123;</span><br><span class="line">            responseVO.fail(<span class="string">&quot;用户原密码不正确，请检查！&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="comment">// 确认满足修改条件后对用户信息进行更新</span></span><br><span class="line">        userMybatis.setPassword(Md5Util.md5(modifyDTO.getNewPassword()));</span><br><span class="line">        userMybatis.setGmtModified(date);</span><br><span class="line">        userMybatisMapper.update(userMybatis);</span><br><span class="line">        responseVO.success(<span class="string">&quot;密码修改成功！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 删除用户 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVO <span class="title function_">delete</span><span class="params">(DeleteDTO deleteDTO)</span> &#123;</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseVO</span>();</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">deleteResult</span> <span class="operator">=</span> userMybatisMapper.updateStatusByUserId(deleteDTO.getUerId(),date);</span><br><span class="line">        <span class="keyword">if</span>(deleteResult != <span class="number">1</span>)&#123;</span><br><span class="line">            responseVO.fail(<span class="string">&quot;删除失败，没有更新到或者更新了多条记录！&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>  responseVO;</span><br><span class="line">        &#125;</span><br><span class="line">        responseVO.success(<span class="string">&quot;用户删除成功！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="测试用例"><a class="markdownIt-Anchor" href="#测试用例"></a> 测试用例</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaSpringWingoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;userServiceMybatisImpl&quot;)</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Md5Util 输出 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMd5</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Md5Util.md5(<span class="string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试注册接口 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRegister</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 构造注册的测试数据</span></span><br><span class="line">        <span class="type">RegisterDTO</span> <span class="variable">registerDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegisterDTO</span>();</span><br><span class="line">        registerDTO.setUsername(<span class="string">&quot;Jay&quot;</span>);</span><br><span class="line">        registerDTO.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="comment">// 处理业务</span></span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> userService.register(registerDTO);</span><br><span class="line">        <span class="comment">// 测试断言</span></span><br><span class="line">        assertEquals(ResponseConstant.SUCCESS, responseVO.get(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试登录接口 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLogin</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">LoginDTO</span> <span class="variable">loginDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoginDTO</span>();</span><br><span class="line">        loginDTO.setUsername(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">        loginDTO.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        loginDTO.setType(<span class="number">0</span>);</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> userService.login(loginDTO);</span><br><span class="line">        assertEquals(ResponseConstant.SUCCESS, responseVO.get(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试添加接口 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAdd</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">AddDTO</span> <span class="variable">addDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AddDTO</span>();</span><br><span class="line">        addDTO.setUsername(<span class="string">&quot;Tim&quot;</span>);</span><br><span class="line">        addDTO.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> userService.add(addDTO);</span><br><span class="line">        assertEquals(ResponseConstant.SUCCESS, responseVO.get(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试用户列表接口 */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testView</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> userService.view();</span><br><span class="line">        System.out.println(responseVO);</span><br><span class="line">        assertEquals(ResponseConstant.SUCCESS, responseVO.get(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 测试修改密码接口*/</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testModify</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ModifyDTO</span> <span class="variable">modifyDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModifyDTO</span>();</span><br><span class="line">        modifyDTO.setUsername(<span class="string">&quot;Jay&quot;</span>);</span><br><span class="line">        modifyDTO.setType(<span class="number">0</span>);</span><br><span class="line">        modifyDTO.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        modifyDTO.setNewPassword(<span class="string">&quot;654321&quot;</span>);</span><br><span class="line">        modifyDTO.setConfirmNewPassword(<span class="string">&quot;654321&quot;</span>);</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> userService.modify(modifyDTO);</span><br><span class="line">        assertEquals(ResponseConstant.SUCCESS, responseVO.get(<span class="string">&quot;code&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="控制层"><a class="markdownIt-Anchor" href="#控制层"></a> 控制层</h3>
<h4 id="swagger-整合"><a class="markdownIt-Anchor" href="#swagger-整合"></a> Swagger 整合</h4>
<p>用于浏览器请求测试。</p>
<blockquote>
<p>也可采用 Spring Boot 提供的 swagger 的 stater，利用启动器的方式添加依赖，可以直在 Spring Boot 的配置文件中配置 swagger 的配置信息。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 添加 Swagger 的支持 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2).apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.wingo.user.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.any()).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>().title(<span class="string">&quot;Swagger RESTful APIs&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;Swagger API 服务&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="代码编写"><a class="markdownIt-Anchor" href="#代码编写"></a> 代码编写</h4>
<blockquote>
<ul>
<li>Model model：Spring MVC 提供了一个<code>Model</code>用于暴露后端传递给页面的信息，通过<code>addAttribute(K, V)</code>方法添加数据，并且在前端的模板引擎页面通过<code>$&#123;K&#125;</code>取得对应的<code>V</code>；</li>
<li>HttpServletResponse httpServletResponse：<code>encodeRedirectURL(Url)</code>方法进行页面跳转，跳转的同时携带域中的信息；</li>
<li>HttpSession httpSession：<code>setAttribute(K, V)</code>方法在 Session 域中添加信息。</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 注入 UserService */</span></span><br><span class="line">    <span class="meta">@Resource(name = &quot;userServiceMybatisImpl&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理用户注册的请求 */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;用户注册接口&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">register</span><span class="params">(Model model, <span class="meta">@Valid</span> <span class="meta">@ModelAttribute(value = &quot;registerDTO&quot;)</span> RegisterDTO registerDTO, HttpServletResponse httpServletResponse)</span> &#123;</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> userService.register(registerDTO);</span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="keyword">if</span> (ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123;</span><br><span class="line">            <span class="comment">// 注册成功，重定向到前端登录页面 login.html，并且携带数据过去</span></span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 注册失败，跳转到注册页面，并将失败的信息返回</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.REGISTER);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成图形验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NoSuchAlgorithmException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/imageCode&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">imageCode</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, NoSuchAlgorithmException &#123;</span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="comment">// 生成验证码</span></span><br><span class="line">        Map&lt;String, Object&gt; map = ImageCodeUtil.getImageCode(<span class="number">60</span>, <span class="number">20</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="comment">// 放入客户端的 Session 对象中</span></span><br><span class="line">        request.getSession().setAttribute(ImageCodeConstant.SIMPLE_CAPTCHA,</span><br><span class="line">                                          map.get(ImageCodeConstant.CAPTCHA_VALUE).toString().toLowerCase());</span><br><span class="line">        <span class="comment">// 设置验证码的生成时间，并放入客户端 Session 对象中</span></span><br><span class="line">        request.getSession().setAttribute(ImageCodeConstant.CODE_TIME, System.currentTimeMillis());</span><br><span class="line">        <span class="comment">// 将生成的验证码图片写到图片输出流</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ImageIO.write((BufferedImage) map.get(ImageCodeConstant.IMAGE), ImageCodeConstant.JPEG, os);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;图形验证码生成异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理用户的登录请求 */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(Model model, <span class="meta">@Valid</span> <span class="meta">@ModelAttribute(value = &quot;loginDTO&quot;)</span> LoginDTO loginDTO,</span></span><br><span class="line"><span class="params">                        HttpServletResponse httpServletResponse, HttpSession httpSession)</span> &#123;</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseVO</span>();</span><br><span class="line">        <span class="comment">// 取得用户填写的验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">checkCode</span> <span class="operator">=</span> loginDTO.getCheckCode();</span><br><span class="line">        <span class="comment">// 从 Session 中取得存入的验证码信息</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">sessionImageCode</span> <span class="operator">=</span> httpSession.getAttribute(ImageCodeConstant.SIMPLE_CAPTCHA);</span><br><span class="line">        <span class="comment">// 获取验证码信息失败</span></span><br><span class="line">        <span class="keyword">if</span>(sessionImageCode == <span class="literal">null</span>)&#123;</span><br><span class="line">            responseVO.fail(<span class="string">&quot;请填写验证码&quot;</span>);</span><br><span class="line">            model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> sessionImageCode.toString();</span><br><span class="line">        <span class="comment">// 检测验证码</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">codeTime</span> <span class="operator">=</span> Long.valueOf(httpSession.getAttribute(ImageCodeConstant.CODE_TIME) + <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">// 验证码是否填写正确</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(checkCode) || StringUtils.isBlank(code) || !(checkCode.equalsIgnoreCase(code))) &#123;</span><br><span class="line">            responseVO.fail(<span class="string">&quot;验证码不一致&quot;</span>);</span><br><span class="line">            model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 验证码是否过期（有效期为 5 分钟）</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((date.getTime() - codeTime) / ImageCodeConstant.MILLISECOND_CONVERSION</span><br><span class="line">                 / ImageCodeConstant.MINUTE_CONVERSION &gt; ImageCodeConstant.CAPTCHA_EXPIRY_TIME) &#123;</span><br><span class="line">            responseVO.fail(<span class="string">&quot;验证码已过期&quot;</span>);</span><br><span class="line">            model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 处理用户登录业务</span></span><br><span class="line">        responseVO = userService.login(loginDTO);</span><br><span class="line">        <span class="comment">// 将结果放入 model 中，在模板中可以取到 model 中的值</span></span><br><span class="line">        <span class="comment">// 这里就是交互的一个重要地方，我们可以在模板中通过这些属性值访问到数据</span></span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="comment">// 设置登录 session，模版引擎使用</span></span><br><span class="line">        httpSession.setAttribute(UserConstant.USERNAME, loginDTO.getUsername());</span><br><span class="line">        httpSession.setAttribute(UserConstant.TYPE, loginDTO.getType());</span><br><span class="line">        <span class="comment">// 将类型码转换为中文说明</span></span><br><span class="line">        httpSession.setAttribute(UserConstant.TYPE_NAME, UserTypeConstant.typeToDesc(loginDTO.getType()));</span><br><span class="line">        <span class="comment">// 组装结果返回</span></span><br><span class="line">        <span class="keyword">if</span> (responseVO == <span class="literal">null</span> || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123;</span><br><span class="line">            <span class="comment">// 登录失败则跳转到前端登录页面 login.html</span></span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 登录成功重定向到前端首页 index.html，并且携带数据过去</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.INDEX);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理查看用户列表的请求 */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">users</span><span class="params">(Model model, HttpServletResponse httpServletResponse)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理用户列表查看业务</span></span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> userService.view();</span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="comment">// 开始重定向前端用户列表也 view.html，携带数据过去了。</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.VIEW);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理新增用户的请求 */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;用户新增接口&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">user</span><span class="params">(Model model, <span class="meta">@Valid</span> <span class="meta">@ModelAttribute(value = &quot;addDTO&quot;)</span> AddDTO addDTO,</span></span><br><span class="line"><span class="params">                       HttpServletResponse httpServletResponse)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理新增用户业务</span></span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> userService.add(addDTO);</span><br><span class="line">        <span class="comment">// 将处理结果写入到返回对象中</span></span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="comment">// 用户添加失败，重定向到前端页面 user.html</span></span><br><span class="line">        <span class="keyword">if</span> (responseVO == <span class="literal">null</span> || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE)))&#123;</span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.USER);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 处理成功</span></span><br><span class="line">        responseVO = userService.view();</span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="comment">// 开始重定向，携带数据过去</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.VIEW);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 删除用户 */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除用户接口&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/delete&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">(Model model, <span class="meta">@Valid</span> <span class="meta">@ModelAttribute(value = &quot;deleteDTO&quot;)</span> DeleteDTO deleteDTO,</span></span><br><span class="line"><span class="params">                         HttpServletResponse httpServletResponse)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理逻辑删除用户业务</span></span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> userService.delete(deleteDTO);</span><br><span class="line">        <span class="comment">// 删除失败返回错误信息</span></span><br><span class="line">        <span class="keyword">if</span>(responseVO.get(ResponseConstant.CODE).equals(ResponseConstant.FAIL))&#123;</span><br><span class="line">            model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.VIEW);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 删除成功后再查询用户列表数据，返回删除后的最新用户列表数据</span></span><br><span class="line">        responseVO = userService.view();</span><br><span class="line">        <span class="keyword">if</span> (responseVO != <span class="literal">null</span>) &#123;</span><br><span class="line">            model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 逻辑删除用户后，跳转到用户前端列表页 view.jsp</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.VIEW);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理用户信息修改的请求 */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/modify&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toModify</span><span class="params">(Model model, <span class="meta">@Valid</span> <span class="meta">@ModelAttribute(value = &quot;modifyDTO&quot;)</span> ModifyDTO modifyDTO,</span></span><br><span class="line"><span class="params">                           HttpServletResponse httpServletResponse, HttpSession httpSession)</span> &#123;</span><br><span class="line">        <span class="comment">// 从 Session 中取得用户名字及类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">strUsername</span> <span class="operator">=</span> httpSession.getAttribute(UserConstant.USERNAME).toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">strType</span> <span class="operator">=</span> httpSession.getAttribute(UserConstant.TYPE).toString();</span><br><span class="line">        modifyDTO.setUsername(strUsername);</span><br><span class="line">        modifyDTO.setType(strType);</span><br><span class="line">        <span class="comment">// 处理用户信息修改业务</span></span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">responseVO</span> <span class="operator">=</span> userService.modify(modifyDTO);</span><br><span class="line">        <span class="comment">// 将结果放入 Model 中，在模板中可以取到 Model 中的值</span></span><br><span class="line">        model.addAttribute(ResponseConstant.RESPONSE_VO, responseVO);</span><br><span class="line">        <span class="keyword">if</span> (responseVO == <span class="literal">null</span> || !ResponseConstant.SUCCESS.equals(responseVO.get(ResponseConstant.CODE))) &#123;</span><br><span class="line">            <span class="comment">// 修改失败时，继续重定向到前端用户信息修改页面 modify.html</span></span><br><span class="line">            <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.MODIFY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 密码修改成功，从 Session 中删除 user 属性，用户退出登录</span></span><br><span class="line">        httpSession.removeAttribute(UserConstant.USERNAME);</span><br><span class="line">        httpSession.removeAttribute(UserConstant.TYPE);</span><br><span class="line">        httpSession.removeAttribute(UserConstant.TYPE_NAME);</span><br><span class="line">        <span class="comment">// 开始重定向前端登录页面 login.html，并且携带数据过去</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 注销登录 */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/loginOut&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">loginOut</span><span class="params">(HttpSession httpSession, HttpServletResponse httpServletResponse)</span> &#123;</span><br><span class="line">        <span class="comment">// 从 Session 中删除 user 属性，用户退出登录</span></span><br><span class="line">        httpSession.removeAttribute(UserConstant.USERNAME);</span><br><span class="line">        httpSession.removeAttribute(UserConstant.TYPE);</span><br><span class="line">        httpSession.removeAttribute(UserConstant.TYPE_NAME);</span><br><span class="line">        <span class="comment">// 开始重定向到前端页面 login.html</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.LOGIN);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 处理 Get:/index 请求 */</span></span><br><span class="line">    <span class="meta">@ApiIgnore</span></span><br><span class="line">    <span class="meta">@GetMapping(value=&quot;/index&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(HttpServletResponse httpServletResponse)</span>&#123;</span><br><span class="line">        <span class="comment">// 重定向到前端页面 index.html</span></span><br><span class="line">        <span class="keyword">return</span> httpServletResponse.encodeRedirectURL(UrlConstant.INDEX);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 省略余下页面跳方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="thymeleaf"><a class="markdownIt-Anchor" href="#thymeleaf"></a> Thymeleaf</h3>
<p>引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 支持 Thymeleaf --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置 Thymeleaf：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Thymeleaf 配置</span></span><br><span class="line"><span class="attr">spring.thymeleaf.prefix</span>=<span class="string">classpath:/templates</span></span><br><span class="line"><span class="attr">spring.thymeleaf.suffix</span>=<span class="string">.html</span></span><br><span class="line"><span class="attr">spring.thymeleaf.mode</span>=<span class="string">HTML</span></span><br><span class="line"><span class="attr">spring.thymeleaf.servlet.content-type</span>=<span class="string">text/html</span></span><br><span class="line"><span class="attr">spring.thymeleaf.cache</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">spring.thymeleaf.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<h4 id="loginhtml"><a class="markdownIt-Anchor" href="#loginhtml"></a> login.html</h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;responseVO != null &amp;&amp; responseVO.get(&#x27;message&#x27;) != null&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;responseVO.get(&#x27;message&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;loginDTO&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 27px&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户名: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">th:value</span>=<span class="string">&quot;$&#123;registerDTO !=null &amp;&amp; registerDTO.username != null&#125; ? $&#123;registerDTO.username&#125; : &#x27;&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">                       /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 27px&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>密码: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 27px&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;checkCode&quot;</span> <span class="attr">class</span>=<span class="string">&quot;green&quot;</span>&gt;</span>验证码: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;checkCode&quot;</span> <span class="attr">name</span>=<span class="string">&quot;checkCode&quot;</span> <span class="attr">class</span>=<span class="string">&quot;checkCode&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;验证码&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&quot;cursor: pointer; margin-left: 3px;&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/imageCode&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">onclick</span>=<span class="string">&quot;this.src=this.src + &#x27;?&#x27; + new Date().valueOf();&quot;</span> <span class="attr">id</span>=<span class="string">&quot;validateImg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;验证码&quot;</span> <span class="attr">class</span>=<span class="string">&quot;codePic&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">title</span>=<span class="string">&quot;验证码。点击此处更新验证码。&quot;</span></span></span><br><span class="line"><span class="tag">       			/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 27px&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;type&quot;</span>&gt;</span>用户类型: <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;type&quot;</span> <span class="attr">name</span>=<span class="string">&quot;type&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> &gt;</span>普通用户<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">option</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> &gt;</span>管理员用户<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="indexhtml"><a class="markdownIt-Anchor" href="#indexhtml"></a> index.html</h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>登录后的首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span></span><br><span class="line">        欢迎您：<span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.username&#125;?$&#123;session.username&#125;:&#x27;（您未登录）&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>, 用户身份是：<span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.typeName&#125;?$&#123;session.typeName&#125;:&#x27;（您未登录）&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.username != null&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/users&#125;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.typeName eq &#x27;管理员&#x27;&#125;&quot;</span>&gt;</span>查看用户列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/user&#125;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.typeName eq &#x27;管理员&#x27;&#125; &quot;</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/modify&#125;&quot;</span>&gt;</span>修改密码<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/loginOut&#125;&quot;</span>&gt;</span>注销登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="modifyhtml"><a class="markdownIt-Anchor" href="#modifyhtml"></a> modify.html</h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>修改密码<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;responseVO != null &amp;&amp; responseVO.get(&#x27;message&#x27;) != null&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;responseVO.get(&#x27;message&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.username != null&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/modify&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;modifyDTO&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>原密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;newPassword&quot;</span>&gt;</span>新密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;newPassword&quot;</span> <span class="attr">id</span>=<span class="string">&quot;newPassword&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;confirmNewPassword&quot;</span>&gt;</span>确认新密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;confirmNewPassword&quot;</span> <span class="attr">id</span>=<span class="string">&quot;confirmNewPassword&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;确认修改&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="registerhtml"><a class="markdownIt-Anchor" href="#registerhtml"></a> register.html</h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>用户注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;responseVO != null &amp;&amp; responseVO.get(&#x27;message&#x27;) != null&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;responseVO.get(&#x27;message&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/register&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;registerDTO&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户名:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注册&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="userhtml"><a class="markdownIt-Anchor" href="#userhtml"></a> user.html</h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;responseVO != null &amp;&amp; responseVO.get(&#x27;message&#x27;) != null&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;responseVO.get(&#x27;message&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.username != null &amp;&amp; session.typeName == &#x27;管理员&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/user&#125;&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;addDTO&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户名:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>密码:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="viewhtml"><a class="markdownIt-Anchor" href="#viewhtml"></a> view.html</h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>查看用户列表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>名字<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户类型<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>注册时间<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>操作类型<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.username != null &amp;&amp; session.typeName == &#x27;管理员&#x27;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 循环展示普通用户清单 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th:block</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;responseVO.get(&#x27;data&#x27;).viewVO != null&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;ViewVO : $&#123;responseVO.get(&#x27;data&#x27;).viewVO&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ViewVO.userId&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ViewVO.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;ViewVO.type&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(ViewVO.gmtCreate, &#x27;yyyy-MM-dd&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/delete(uerId=$&#123;ViewVO.userId&#125;)&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">th:block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="过滤器"><a class="markdownIt-Anchor" href="#过滤器"></a> 过滤器</h3>
<p>对某些特定页面的访问需要有一定的前提条件：比如用户是否登录，用户是否拥有访问此页面的权限等。要实现这样的功能可以使用 Filter。</p>
<blockquote>
<p>过滤器执行顺序：<br />
(1) 通过实例化 FilterRegistrationBean 类自定义 Filter，setOrder() 方法可以定义执行顺序。（小的优先）<br />
(2) 通过限定类名限定 Filter 的顺序。（默认初始化过滤器时进行了类名的排序）</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;/Filter0Session&quot;, </span></span><br><span class="line"><span class="meta">           urlPatterns = &#123;&quot;/index&quot;, &quot;/add&quot;, &quot;/modify&quot;, &quot;/view&quot;, &quot;/delete&quot;, &quot;/loginOut&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Filter0Session</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Filter0Session</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 过滤器初始化方法，web 服务器根据配置创建 Filter 实例 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig fConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="comment">// Do nothing.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpServletRequest</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">httpServletResponse</span> <span class="operator">=</span> (HttpServletResponse) response;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">httpSession</span> <span class="operator">=</span> httpServletRequest.getSession(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (httpSession != <span class="literal">null</span> &amp;&amp; httpSession.getAttribute(UserConstant.USERNAME) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 用户已登录则放行</span></span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 检测到用户未登录则跳转重定向到登陆页面</span></span><br><span class="line">            httpServletResponse.sendRedirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/** 过滤器销毁方法，可以释放过滤器使用的资源 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Do nothing.</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;/Filter1Admin&quot;, urlPatterns = &#123;&quot;/add&quot;, &quot;/view&quot;, &quot;/delete&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Filter1Admin</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Filter1Admin</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig fConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="comment">// Do nothing.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpServletRequest</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">httpServletResponse</span> <span class="operator">=</span> (HttpServletResponse) response;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">httpSession</span> <span class="operator">=</span> httpServletRequest.getSession(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 检测用户是否登录，并且用户类型是否为管理员</span></span><br><span class="line">        <span class="keyword">if</span> (httpSession != <span class="literal">null</span> &amp;&amp; httpSession.getAttribute(UserConstant.USERNAME) != <span class="literal">null</span></span><br><span class="line">            &amp;&amp; httpSession.getAttribute(UserConstant.TYPE) != <span class="literal">null</span></span><br><span class="line">            &amp;&amp; UserTypeConstant.ADMIN.equals(httpSession.getAttribute(UserConstant.TYPE))) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            httpServletResponse.sendRedirect( <span class="string">&quot;/login&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Do nothing.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>！！！@ServletComponentScan(value = “com.wingo.user.filter”)</p>
</blockquote>
<h3 id="全局异常处理"><a class="markdownIt-Anchor" href="#全局异常处理"></a> 全局异常处理</h3>
<p>对于前端传输的数据，在 DTO 类中添加 JSR303 校验，在测试的时候发现此校验的抛出异常时，Spring Boot 会自动跳转到默认的 error 页面。原因在于项目中未对此校验索抛出的异常进行处理。先看看校验后所抛出的异常信息。</p>
<p>Spring Boot 默认的错误提示页面：</p>
<p><img src="/img/2020/03/UserManagementSystem/ValidError01.png" alt="" /></p>
<p>控制台抛出的异常<code>BindException: org.springframework.validation.BeanPropertyBindingResult: 3 errors</code></p>
<blockquote>
<p>可以在 controller 类中添加 try{ }catch{ } 异常处理块捕捉异常抛出，并进行处理（如返回 Json）。但这样代码很不美观，推荐使用的方式是用注解 @ControllerAdvice + @ExceptionHandler 全局处理 Controller 层异常。</p>
</blockquote>
<p>编写全局处理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span> <span class="comment">// 声明全局的异常处理类</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 定义捕捉的异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BindException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVO <span class="title function_">resolveMethodArgumentNotValidException</span><span class="params">(BindException exception)</span> &#123;</span><br><span class="line">        <span class="type">ResponseVO</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseVO</span>();</span><br><span class="line">        <span class="comment">// 定义字段及校验异常信息的 key / value 结构</span></span><br><span class="line">        Map&lt;String, String&gt; fieldAndMessage = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="comment">// 组装字段及校验异常信息</span></span><br><span class="line">        <span class="keyword">for</span> (FieldError fieldError : exception.getBindingResult().getFieldErrors()) &#123;</span><br><span class="line">            fieldAndMessage.put(fieldError.getField(), fieldError.getDefaultMessage());</span><br><span class="line">            sb.append(fieldError.getField()).append(<span class="string">&quot;:&quot;</span>).append(fieldError.getDefaultMessage()).append(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">strField</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">        <span class="comment">// 组装异常信息：从自定义的异常信息枚举类中取得信息</span></span><br><span class="line">        response.setCode(ResponseCodeTypeEnum.PARAMETER_ERROR.getCode());</span><br><span class="line">        response.setMessage(ResponseCodeTypeEnum.PARAMETER_ERROR.getMessage());</span><br><span class="line">        <span class="comment">// 方便调试：将异常统一打印出来</span></span><br><span class="line">        log.warn(<span class="string">&quot;BindException.class 异常信息: &#123;&#125;&quot;</span>, strField);</span><br><span class="line">        <span class="comment">// 返回 Json</span></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：此时已不显示默认的错误页面，而是显示由用户定义的 Json 字符串。</p>
<p><img src="/img/2020/03/UserManagementSystem/ValidError02.png" alt="" /></p>
<p>控制台输出：方便开发调试。</p>
<p><img src="/img/2020/03/UserManagementSystem/ValidError03.png" alt="" /></p>
<h3 id="自定义-sql-日志打印"><a class="markdownIt-Anchor" href="#自定义-sql-日志打印"></a> 自定义 SQL 日志打印</h3>
<p>当开启 Mybatis 的默认日志打印，控制台的 SQL 默认打印样式：</p>
<p><img src="/img/2020/03/UserManagementSystem/SQLLog01.png" alt="" /></p>
<p>自定义拦截器：</p>
<p>[Mybatis 插件拦截器]([<a target="_blank" rel="noopener" href="https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis%20%E6%8F%92%E4%BB%B6%E4%B9%8B%E6%8B%A6%E6%88%AA%E5%99%A8/">https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis 插件之拦截器/</a>](<a target="_blank" rel="noopener" href="https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis">https://welab-wingo.cn/2020/03/29/Software/Mybatis/Mybatis</a> 插件之拦截器/))</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Intercepts(&#123;@Signature(type = Executor.class, method = &quot;update&quot;, </span></span><br><span class="line"><span class="meta">                        args = &#123;MappedStatement.class, Object.class&#125;),</span></span><br><span class="line"><span class="meta">        @Signature(type = Executor.class, method = &quot;query&quot;,</span></span><br><span class="line"><span class="meta">                args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125;)&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Properties properties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// MappedStatement 维护了一条 mapper.xml 文件里面 select 、update、delete、insert 节点的封装</span></span><br><span class="line">        <span class="type">MappedStatement</span> <span class="variable">mappedStatement</span> <span class="operator">=</span> (MappedStatement) invocation.getArgs()[<span class="number">0</span>];</span><br><span class="line">        <span class="type">Object</span> <span class="variable">parameter</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (invocation.getArgs().length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            parameter = invocation.getArgs()[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sqlId</span> <span class="operator">=</span> mappedStatement.getId();</span><br><span class="line">        <span class="comment">// 获取动态生成的 SQL 语句以及相应的参数信息对象</span></span><br><span class="line">        <span class="type">BoundSql</span> <span class="variable">boundSql</span> <span class="operator">=</span> mappedStatement.getBoundSql(parameter);</span><br><span class="line">        <span class="comment">// MyBatis 所有的配置信息都维持在 Configuration 对象之中，包括 id、Statement 类型、SQL 类型、mapper 的 xml 文件的绝对地址、是否使用缓存等配置</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> mappedStatement.getConfiguration();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 继续执行原目标方法</span></span><br><span class="line">        returnValue = invocation.proceed();</span><br><span class="line">        <span class="comment">// 获取实体类</span></span><br><span class="line">        Class&lt;?&gt; parameterType = getParameterType(mappedStatement);</span><br><span class="line">        <span class="comment">/** 判断实体类上是否包含 <span class="doctag">@SqlPrint</span> 注解，不包含的话直接返回 */</span></span><br><span class="line">        <span class="keyword">if</span> (!hasSqlPrintAnnotation(parameterType)) &#123;</span><br><span class="line">            <span class="keyword">return</span> returnValue;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> (end - start);</span><br><span class="line">        <span class="comment">/** 当 SQL 执行大于 1 毫秒时打印 SQL，所以也可以用于慢 SQL 的打印及监控 */</span></span><br><span class="line">        <span class="keyword">if</span> (time &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> getSql(configuration, boundSql, sqlId, time);</span><br><span class="line">            log.info(sql);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回执行后的结果</span></span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作用：包装目标对象，包装的意思就是为目标对象创建一个代理对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="comment">/** 判断下需要拦截的目标对象类型，需要拦截时才拦截，否则直接返回本身，减少被代理的次数 */</span></span><br><span class="line">        <span class="keyword">if</span> (target <span class="keyword">instanceof</span> Executor) &#123;</span><br><span class="line">            <span class="comment">// 借助 Plugin 的 wrap 方法来使用当前的拦截器包装我们的目标对象，返回的就是为当前 target 创建的动态代理</span></span><br><span class="line">            <span class="comment">// 使用 JDK 的动态代理，给 target 对象创建一个 delegate 代理对象，以此来实现方法拦截和增强功能，它会回调 intercept() 方法。</span></span><br><span class="line">            <span class="keyword">return</span> Plugin.wrap(target, <span class="built_in">this</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 无需拦截则直接返回目标对象本身</span></span><br><span class="line">            <span class="keyword">return</span> target;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将插件注册时的 property 属性设置进来</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.properties = properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组装需要打印的信息，包括 SQL 语句、特殊标记、SQL 执行时间等</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> configuration MyBatis 所有的配置信息都维持在 Configuration 对象之中</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> boundSql 表示动态生成的 SQL 语句以及相应的参数信息对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sqlId 拦截的执行 SQL 的id（可以理解为方法）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time SQL 执行时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getSql</span><span class="params">(Configuration configuration, BoundSql boundSql, String sqlId, <span class="type">long</span> time)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> showSql(configuration, boundSql);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 拦截的执行 SQL 的id（可以理解为方法），例如：com.gorge4j.user.mapper.UserManageDemoMyBatisMapper.update</span></span><br><span class="line">        str.append(sqlId);</span><br><span class="line">        str.append(<span class="string">&quot; : &quot;</span>);</span><br><span class="line">        <span class="comment">// 具体执行的 SQL 语句</span></span><br><span class="line">        str.append(sql);</span><br><span class="line">        str.append(<span class="string">&quot; &gt;&gt;&gt;&gt;&gt;&gt; &quot;</span>);</span><br><span class="line">        <span class="comment">// SQL 执行的时间</span></span><br><span class="line">        str.append(<span class="string">&quot;SQL执行耗时: &quot;</span>);</span><br><span class="line">        str.append(time);</span><br><span class="line">        str.append(<span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> str.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 按类型格式化 SQL 里的参数 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getFormatParameterValue</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            value = <span class="string">&quot;&#x27;&quot;</span> + obj.toString() + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Date) &#123;</span><br><span class="line">            <span class="type">DateFormat</span> <span class="variable">formatter</span> <span class="operator">=</span> DateFormat.getDateTimeInstance(DateFormat.DEFAULT, DateFormat.DEFAULT, Locale.CHINA);</span><br><span class="line">            value = <span class="string">&quot;&#x27;&quot;</span> + formatter.format(<span class="keyword">new</span> <span class="title class_">Date</span>()) + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (obj != <span class="literal">null</span>) &#123;</span><br><span class="line">                value = obj.toString();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 组装需要打印的 SQL */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">showSql</span><span class="params">(Configuration configuration, BoundSql boundSql)</span> &#123;</span><br><span class="line">        <span class="comment">// 取得参数的对象，实际上就是一个多个参数的 map 结构</span></span><br><span class="line">        <span class="comment">// 示例：parameterObject:MapperMethod&#123;password=123456,name=xxxxxx,type=O,param3=O,param1=xxxxxx,param2=123456&#125;</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">parameterObject</span> <span class="operator">=</span> boundSql.getParameterObject();</span><br><span class="line">        <span class="comment">// 查询 SQL 中的参数</span></span><br><span class="line">        List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();</span><br><span class="line">        <span class="comment">// 将 SQL 中一个或多个回车换行符号替换成一个空格</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> boundSql.getSql().replaceAll(<span class="string">&quot;[\\s]+&quot;</span>, <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!parameterMappings.isEmpty() &amp;&amp; parameterObject != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Mybatis 在启动时就会通过 TypeHandlerRegistry 进行注册，即建立 JdbcType, JavaType, TypeHandler 三者之间的关系。</span></span><br><span class="line">            <span class="comment">// 因此，这意味着在 Mybatis 启动时我们也需要通过 TypeHandlerRegistry 将我们的所有的枚举类型（JavaType）与自定义的枚举</span></span><br><span class="line">            <span class="comment">// TypeHandler（EnumTypeHandler）建立联系</span></span><br><span class="line">            <span class="type">TypeHandlerRegistry</span> <span class="variable">typeHandlerRegistry</span> <span class="operator">=</span> configuration.getTypeHandlerRegistry();</span><br><span class="line">            <span class="comment">// 自定义 TypeHandler 时会走这个逻辑，建立 JavaType 和 JdbcType 之间的联系</span></span><br><span class="line">            <span class="keyword">if</span> (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123;</span><br><span class="line">                <span class="comment">// 替换 SQL 中的占位符 “?” 为具体的参数，replaceFirst 作为是替换匹配到的第一个占位符 “?”</span></span><br><span class="line">                sql = sql.replaceFirst(<span class="string">&quot;\\?&quot;</span>, getFormatParameterValue(parameterObject));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 没有自定义的 TypeHandler，走通用逻辑</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 拿到 target（拦截对象）的元数据</span></span><br><span class="line">                <span class="type">MetaObject</span> <span class="variable">metaObject</span> <span class="operator">=</span> configuration.newMetaObject(parameterObject);</span><br><span class="line">                <span class="comment">// 参数是按顺序存储的，下面逻辑按顺序来替换</span></span><br><span class="line">                <span class="keyword">for</span> (ParameterMapping parameterMapping : parameterMappings) &#123;</span><br><span class="line">                    <span class="comment">// 获取参数的名称</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">propertyName</span> <span class="operator">=</span> parameterMapping.getProperty();</span><br><span class="line">                    <span class="comment">// 如果元数据对象中存在该参数，则替换相应的占位符 “?”</span></span><br><span class="line">                    <span class="keyword">if</span> (metaObject.hasGetter(propertyName)) &#123;</span><br><span class="line">                        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> metaObject.getValue(propertyName);</span><br><span class="line">                        sql = sql.replaceFirst(<span class="string">&quot;\\?&quot;</span>, getFormatParameterValue(obj));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 如果有额外的参数，走下面的逻辑</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (boundSql.hasAdditionalParameter(propertyName)) &#123;</span><br><span class="line">                        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> boundSql.getAdditionalParameter(propertyName);</span><br><span class="line">                        sql = sql.replaceFirst(<span class="string">&quot;\\?&quot;</span>, getFormatParameterValue(obj));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回组装好的 SQL</span></span><br><span class="line">        <span class="keyword">return</span> sql;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** 获取实体对象类：class com.gorge4j.user.entity.UserManageDemoMyBatis */</span></span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt; getParameterType(MappedStatement statement) &#123;</span><br><span class="line">        <span class="keyword">if</span> (statement.getParameterMap() == <span class="literal">null</span> || statement.getParameterMap().getType() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> statement.getParameterMap().getType();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 判断实体类上是否包含自定义的 SQl 打印的注解 <span class="doctag">@SqlPrint</span> */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">hasSqlPrintAnnotation</span><span class="params">(Class&lt;?&gt; classType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> classType == <span class="literal">null</span> ? Boolean.FALSE : classType.isAnnotationPresent(SqlPrint.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：需要在实体类上添加自定义注解 @SqlPrint</p>
</blockquote>
<p>自定义注解类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SqlPrint &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义的 SQL 日志打印样式：</p>
<p><img src="/img/2020/03/UserManagementSystem/SQLLog03.png" alt="" /></p>
<h3 id="跨域"><a class="markdownIt-Anchor" href="#跨域"></a> 跨域</h3>
<blockquote>
<p>跨域，是指浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对 JavaScript 实施的安全策略。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">		registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">            .allowedOrigins(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">            .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">            .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">            .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)</span><br><span class="line">            .maxAge(<span class="number">3600</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// 配置 Swagger 的资源映射</span></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line"></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;swagger-ui.html&quot;</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line"></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">                .addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="注意"><a class="markdownIt-Anchor" href="#注意"></a> 注意</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> EnableWebMvc 用了此注解默认配置的 MVC 失效，需要用户重新配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> WebMvcConfigurer</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfigurationSupport</span> ...</span><br></pre></td></tr></table></figure>
<h3 id="自定义校验"><a class="markdownIt-Anchor" href="#自定义校验"></a> 自定义校验</h3>
<blockquote>
<p>除了使用默认提供的 Validator，用户还可以提供具有自定义校验规则的 Validator。</p>
</blockquote>
<h4 id="注解类"><a class="markdownIt-Anchor" href="#注解类"></a> 注解类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = UsernameValidator.class)</span> <span class="comment">// 引入校验规则类进行校验</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Username &#123;</span><br><span class="line">    <span class="comment">// 错误提示消息 @Username(message = &quot;&quot;)</span></span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&#123;com.wingo.user.annotaion.Username.message&#125;&quot;</span>;</span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = PasswordValidator.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Password &#123;</span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&#123;com.wingo.user.annotaion.Password.message&#125;&quot;</span>;</span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="校验类"><a class="markdownIt-Anchor" href="#校验类"></a> 校验类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UsernameValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;Username, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(Username constraintAnnotation)</span> &#123;</span><br><span class="line">        <span class="comment">// do nothing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String value, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Pattern.matches(RegexConstant.REGEX_USERNAME, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PasswordValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;Password, String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(Password constraintAnnotation)</span> &#123;</span><br><span class="line">        <span class="comment">// do nothing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String value, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 正则匹配</span></span><br><span class="line">        <span class="keyword">return</span> Pattern.matches(RegexConstant.REGEX_PASS, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="请求响应打印"><a class="markdownIt-Anchor" href="#请求响应打印"></a> 请求响应打印</h3>
<blockquote>
<p>切面：方法前打印请求信息参数；方法后打印响应信息。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReqAndRespLogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求参数的日志打印</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 切点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;within(com.wingo.user.controller.*)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取传入目标方法的参数对象</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        <span class="comment">// 获取封装了署名信息的对象,在该对象中可以获取到目标方法名,所属类的Class等信息</span></span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">methodSignature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        <span class="comment">// 获取方法对象</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> methodSignature.getMethod();</span><br><span class="line">        <span class="comment">// 分割组装参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">strArgs</span> <span class="operator">=</span> StringUtils.join(args, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;&#123;&#125;.&#123;&#125; - 请求参数: &#123;&#125;&quot;</span>, method.getDeclaringClass().getName(), method.getName(), strArgs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应结果的日志打印</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint 切点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> res 响应结果对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;within(com.wingo.user.controller.*)&quot;, returning = &quot;res&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(JoinPoint joinPoint, Object res)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取封装了署名信息的对象,在该对象中可以获取到目标方法名,所属类的 Class 等信息</span></span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">methodSignature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        <span class="comment">// 获取方法对象</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> methodSignature.getMethod();</span><br><span class="line">        <span class="comment">// 将返回对象转换成 Json 字符串，项目的返回如果不是 Json 的数据格式，那么返回参数就只有 URL</span></span><br><span class="line">        <span class="comment">// String strRes = JSONUtils.toJSONString(res);</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">strRes</span> <span class="operator">=</span> res.toString();</span><br><span class="line">        log.info(<span class="string">&quot;&#123;&#125;.&#123;&#125; - 返回结果: &#123;&#125;&quot;</span>, method.getDeclaringClass().getName(), method.getName(), strRes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <!-- <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://wingowen.github.io/2020/03/07/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" title="用户管理系统" target="_blank" rel="external">https://wingowen.github.io/2020/03/07/后台技术/项目开发/用户管理系统/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">WINGO.WEN</span><small class="ml-1x"></small></a></h3>
        <div>一个疯子。</div>
      </div>
    </figure>
  </div>
</div>


    </div> -->
  </article>
  
    
  <section id="comments">
  	
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2020/03/12/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="开发常用工具类"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2020/03/05/%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AF/Spring%20Boot/Spring%20Boot%20%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/" title="Spring Boot 数据访问"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn " data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">    <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
    <div class="copyright">
    	
        <div class="publishby">
        	<!-- Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>. -->
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   






</body>
</html>